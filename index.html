<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ef4444;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .movie-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .movie-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
        }
        .modal {
            backdrop-filter: blur(8px);
        }
        .favorite-btn {
            transition: all 0.3s ease;
        }
        .favorite-btn.active {
            color: #ef4444;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-red-900 to-gray-900 min-h-screen text-white">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold mb-2 bg-gradient-to-r from-red-400 to-yellow-400 bg-clip-text text-transparent">
                üé¨ Movie Explorer
            </h1>
            <p class="text-gray-400">Discover your favorite movies</p>
        </div>

        <!-- Search Section -->
        <div class="bg-gray-800 rounded-lg shadow-xl p-6 mb-8">
            <div class="flex gap-3 mb-4">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Search for movies (e.g., Batman, Inception)..."
                    class="flex-1 px-4 py-3 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                    onkeypress="if(event.key === 'Enter') searchMovies()"
                >
                <button 
                    onclick="searchMovies()"
                    class="px-6 py-3 bg-gradient-to-r from-red-500 to-yellow-500 rounded-lg font-semibold hover:from-red-600 hover:to-yellow-600 transition-all transform hover:scale-105"
                >
                    Search
                </button>
                <button 
                    onclick="showFavorites()"
                    class="px-6 py-3 bg-gray-700 rounded-lg font-semibold hover:bg-gray-600 transition-all"
                    title="View Favorites"
                >
                    ‚ù§Ô∏è Favorites
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden flex justify-center items-center py-20">
            <div class="loading"></div>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="hidden bg-red-500 bg-opacity-20 border border-red-500 rounded-lg p-4 mb-8 text-center">
            <p class="text-red-300 font-semibold"></p>
        </div>

        <!-- Movies Grid -->
        <div id="moviesGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 mb-8">
        </div>

        <!-- Load More Button -->
        <div id="loadMoreSection" class="hidden text-center mb-8">
            <button 
                onclick="loadMoreMovies()"
                class="px-8 py-3 bg-gradient-to-r from-red-500 to-yellow-500 rounded-lg font-semibold hover:from-red-600 hover:to-yellow-600 transition-all transform hover:scale-105"
            >
                Load More
            </button>
        </div>
    </div>

    <!-- Movie Details Modal -->
    <div id="movieModal" class="hidden fixed inset-0 bg-black bg-opacity-80 modal flex items-center justify-center z-50 p-4" onclick="closeModal(event)">
        <div class="bg-gray-800 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div id="modalContent" class="p-6">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // IMPORTANT: Replace with your own OMDb API key
        // Get free key at: https://www.omdbapi.com/apikey.aspx
        const API_KEY = '692309de'; // Demo key (limited requests)
        const API_URL = 'http://www.omdbapi.com/';

        let currentSearch = '';
        let currentPage = 1;
        let totalResults = 0;
        let favorites = {}; // In-memory favorites storage

        // Function to fetch movie details - returns a Promise
        function fetchMovieDetails(id) {
            return new Promise((resolve, reject) => {
                fetch(`${API_URL}?apikey=${API_KEY}&i=${id}&plot=full`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to fetch movie details');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.Response === 'False') {
                            throw new Error(data.Error || 'Movie not found');
                        }
                        resolve(data);
                    })
                    .catch(error => reject(error));
            });
        }

        // Async function to search movies
        async function searchMovies() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            
            if (!searchTerm) {
                showError('Please enter a movie title to search');
                return;
            }

            currentSearch = searchTerm;
            currentPage = 1;

            showLoading();
            hideError();
            clearMoviesGrid();
            hideLoadMore();

            try {
                const response = await fetch(`${API_URL}?apikey=${API_KEY}&s=${searchTerm}&page=${currentPage}`);
                const data = await response.json();

                hideLoading();

                if (data.Response === 'False') {
                    showError(data.Error || 'No movies found. Try a different search term.');
                    return;
                }

                totalResults = parseInt(data.totalResults);
                displayMovies(data.Search);

                // Show load more if there are more results
                if (totalResults > currentPage * 10) {
                    showLoadMore();
                }

            } catch (error) {
                hideLoading();
                showError('Failed to fetch movies. Please try again later.');
                console.error('Error:', error);
            }
        }

        // Async function to load more movies (pagination)
        async function loadMoreMovies() {
            if (!currentSearch) return;

            currentPage++;
            showLoading();

            try {
                const response = await fetch(`${API_URL}?apikey=${API_KEY}&s=${currentSearch}&page=${currentPage}`);
                const data = await response.json();

                hideLoading();

                if (data.Response === 'True') {
                    displayMovies(data.Search, true); // append to existing

                    // Hide load more if no more results
                    if (totalResults <= currentPage * 10) {
                        hideLoadMore();
                    }
                }

            } catch (error) {
                hideLoading();
                showError('Failed to load more movies.');
                console.error('Error:', error);
            }
        }

        // Display movies in grid
        function displayMovies(movies, append = false) {
            const grid = document.getElementById('moviesGrid');
            
            if (!append) {
                grid.innerHTML = '';
            }

            movies.forEach(movie => {
                const isFavorite = favorites[movie.imdbID] !== undefined;
                const posterUrl = movie.Poster !== 'N/A' ? movie.Poster : 'https://via.placeholder.com/300x450?text=No+Poster';

                const movieCard = document.createElement('div');
                movieCard.className = 'movie-card bg-gray-800 rounded-lg overflow-hidden cursor-pointer relative';
                movieCard.innerHTML = `
                    <div class="relative">
                        <img src="${posterUrl}" alt="${movie.Title}" class="w-full h-80 object-cover" onerror="this.src='https://via.placeholder.com/300x450?text=No+Poster'">
                        <button 
                            onclick="toggleFavorite('${movie.imdbID}', event)"
                            class="favorite-btn absolute top-2 right-2 bg-gray-900 bg-opacity-70 rounded-full p-2 text-2xl ${isFavorite ? 'active' : ''}"
                            title="Add to favorites"
                        >
                            ${isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}
                        </button>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg mb-1 truncate">${movie.Title}</h3>
                        <p class="text-gray-400 text-sm">${movie.Year}</p>
                        <p class="text-gray-500 text-xs mt-1">${movie.Type.toUpperCase()}</p>
                    </div>
                `;

                movieCard.addEventListener('click', (e) => {
                    if (!e.target.closest('.favorite-btn')) {
                        showMovieDetails(movie.imdbID);
                    }
                });

                grid.appendChild(movieCard);
            });
        }

        // Show movie details in modal using Promise
        async function showMovieDetails(movieId) {
            const modal = document.getElementById('movieModal');
            const modalContent = document.getElementById('modalContent');

            // Show loading in modal
            modalContent.innerHTML = `
                <div class="flex justify-center items-center py-20">
                    <div class="loading"></div>
                </div>
            `;
            modal.classList.remove('hidden');

            try {
                // Use the Promise-based function
                const movie = await fetchMovieDetails(movieId);
                const isFavorite = favorites[movie.imdbID] !== undefined;

                modalContent.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="text-3xl font-bold text-red-400">${movie.Title}</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-white text-3xl">&times;</button>
                    </div>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="md:col-span-1">
                            <img src="${movie.Poster !== 'N/A' ? movie.Poster : 'https://via.placeholder.com/300x450?text=No+Poster'}" 
                                 alt="${movie.Title}" 
                                 class="w-full rounded-lg shadow-lg"
                                 onerror="this.src='https://via.placeholder.com/300x450?text=No+Poster'">
                            <button 
                                onclick="toggleFavorite('${movie.imdbID}', event)"
                                class="w-full mt-4 px-4 py-3 ${isFavorite ? 'bg-red-600 hover:bg-red-700' : 'bg-gray-700 hover:bg-gray-600'} rounded-lg font-semibold transition-all"
                            >
                                ${isFavorite ? '‚ù§Ô∏è Remove from Favorites' : 'ü§ç Add to Favorites'}
                            </button>
                        </div>
                        <div class="md:col-span-2">
                            <div class="space-y-4">
                                <div>
                                    <p class="text-gray-400 text-sm">Released</p>
                                    <p class="text-xl font-semibold">${movie.Released}</p>
                                </div>
                                <div>
                                    <p class="text-gray-400 text-sm">Genre</p>
                                    <p class="text-lg">${movie.Genre}</p>
                                </div>
                                <div>
                                    <p class="text-gray-400 text-sm">Director</p>
                                    <p class="text-lg">${movie.Director}</p>
                                </div>
                                <div>
                                    <p class="text-gray-400 text-sm">Cast</p>
                                    <p class="text-lg">${movie.Actors}</p>
                                </div>
                                <div>
                                    <p class="text-gray-400 text-sm">Plot</p>
                                    <p class="text-gray-300 leading-relaxed">${movie.Plot}</p>
                                </div>
                                <div class="grid grid-cols-3 gap-4 pt-4 border-t border-gray-700">
                                    <div class="text-center">
                                        <p class="text-gray-400 text-sm">IMDb Rating</p>
                                        <p class="text-2xl font-bold text-yellow-400">‚≠ê ${movie.imdbRating}</p>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-gray-400 text-sm">Runtime</p>
                                        <p class="text-2xl font-bold">${movie.Runtime}</p>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-gray-400 text-sm">Rated</p>
                                        <p class="text-2xl font-bold">${movie.Rated}</p>
                                    </div>
                                </div>
                                ${movie.Awards !== 'N/A' ? `
                                    <div class="bg-yellow-500 bg-opacity-10 border border-yellow-500 rounded-lg p-3">
                                        <p class="text-yellow-400 font-semibold">üèÜ ${movie.Awards}</p>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                modalContent.innerHTML = `
                    <div class="text-center py-10">
                        <p class="text-red-400 text-xl mb-4">Failed to load movie details</p>
                        <button onclick="closeModal()" class="px-6 py-2 bg-gray-700 rounded-lg hover:bg-gray-600">Close</button>
                    </div>
                `;
                console.error('Error:', error);
            }
        }

        // Toggle favorite
        function toggleFavorite(movieId, event) {
            event.stopPropagation();
            
            if (favorites[movieId]) {
                delete favorites[movieId];
            } else {
                // Fetch movie details to store in favorites
                fetchMovieDetails(movieId).then(movie => {
                    favorites[movieId] = {
                        imdbID: movie.imdbID,
                        Title: movie.Title,
                        Year: movie.Year,
                        Poster: movie.Poster,
                        Type: movie.Type
                    };
                    // Refresh current view if on favorites page
                    if (document.getElementById('moviesGrid').dataset.view === 'favorites') {
                        showFavorites();
                    } else {
                        // Update the favorite button
                        searchMovies();
                    }
                }).catch(err => console.error('Error adding to favorites:', err));
                return;
            }
            
            // Refresh current view
            if (document.getElementById('moviesGrid').dataset.view === 'favorites') {
                showFavorites();
            } else {
                searchMovies();
            }
        }

        // Show favorites
        function showFavorites() {
            const grid = document.getElementById('moviesGrid');
            grid.dataset.view = 'favorites';
            grid.innerHTML = '';
            hideLoadMore();
            hideError();

            const favMovies = Object.values(favorites);

            if (favMovies.length === 0) {
                showError('No favorites yet. Add some movies to your favorites!');
                return;
            }

            displayMovies(favMovies);
        }

        // Close modal
        function closeModal(event) {
            if (!event || event.target.id === 'movieModal') {
                document.getElementById('movieModal').classList.add('hidden');
            }
        }

        // UI Helper Functions
        function showLoading() {
            document.getElementById('loadingState').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingState').classList.add('hidden');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.querySelector('p').textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('errorMessage').classList.add('hidden');
        }

        function clearMoviesGrid() {
            const grid = document.getElementById('moviesGrid');
            grid.innerHTML = '';
            delete grid.dataset.view;
        }

        function showLoadMore() {
            document.getElementById('loadMoreSection').classList.remove('hidden');
        }

        function hideLoadMore() {
            document.getElementById('loadMoreSection').classList.add('hidden');
        }

        // Initialize with a default search
        window.addEventListener('DOMContentLoaded', () => {
            console.log('Movie Explorer ready!');
            document.getElementById('searchInput').value = 'Marvel';
            searchMovies();
        });
    </script>
</body>
</html>