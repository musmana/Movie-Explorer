<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineScope | Movie Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
        }
        .movie-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .movie-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #e94560;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-white">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-10">
            <div class="flex items-center mb-6 md:mb-0">
                <div class="bg-gradient-to-r from-purple-600 to-pink-500 p-3 rounded-lg mr-4">
                    <i class="fas fa-film text-white text-2xl"></i>
                </div>
                <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">CineScope</h1>
            </div>
            
            <div class="flex space-x-4">
                <button id="homeBtn" class="bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300">
                    <i class="fas fa-home mr-2"></i>Home
                </button>
                <button id="favoritesBtn" class="bg-gradient-to-r from-blue-600 to-teal-500 hover:from-blue-700 hover:to-teal-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300">
                    <i class="fas fa-heart mr-2"></i>Favorites
                </button>
            </div>
        </header>

        <!-- Search Section -->
        <section class="mb-12">
            <div class="max-w-2xl mx-auto">
                <div class="relative">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Search for movies..." 
                        class="w-full bg-gray-800 text-white py-4 px-6 pr-12 rounded-xl border border-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    >
                    <button id="searchBtn" class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-gradient-to-r from-purple-600 to-pink-500 text-white p-2 rounded-lg hover:from-purple-700 hover:to-pink-600 transition-all duration-300">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <main>
            <!-- Loading State -->
            <div id="loadingState" class="hidden flex flex-col items-center justify-center py-16">
                <div class="loading-spinner mb-4"></div>
                <p class="text-xl">Loading movies...</p>
            </div>

            <!-- Error State -->
            <div id="errorState" class="hidden flex flex-col items-center justify-center py-16 text-center">
                <i class="fas fa-exclamation-triangle text-5xl text-yellow-500 mb-4"></i>
                <h2 class="text-2xl font-bold mb-2">Oops! Something went wrong</h2>
                <p id="errorMessage" class="text-gray-400 max-w-md">We couldn't fetch the movies. Please try again later.</p>
                <button id="retryBtn" class="mt-6 bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300">
                    Try Again
                </button>
            </div>

            <!-- Movies Grid -->
            <div id="moviesContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-10">
                <!-- Movies will be populated here -->
            </div>

            <!-- Load More Button -->
            <div id="loadMoreContainer" class="hidden flex justify-center mt-8">
                <button id="loadMoreBtn" class="bg-gradient-to-r from-blue-600 to-teal-500 hover:from-blue-700 hover:to-teal-600 text-white font-medium py-3 px-8 rounded-lg transition-all duration-300">
                    <i class="fas fa-plus-circle mr-2"></i>Load More
                </button>
            </div>

            <!-- No Results State -->
            <div id="noResultsState" class="hidden flex flex-col items-center justify-center py-16 text-center">
                <i class="fas fa-film text-5xl text-gray-500 mb-4"></i>
                <h2 class="text-2xl font-bold mb-2">No movies found</h2>
                <p class="text-gray-400 max-w-md">Try searching for a different movie title.</p>
            </div>

            <!-- Favorites Section -->
            <div id="favoritesSection" class="hidden">
                <h2 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-2">Your Favorite Movies</h2>
                <div id="favoritesContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <!-- Favorites will be populated here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Movie Details Modal -->
    <div id="movieModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-50">
        <div class="bg-gray-800 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center p-6 border-b border-gray-700">
                <h2 id="modalTitle" class="text-2xl font-bold">Movie Details</h2>
                <button id="closeModal" class="text-gray-400 hover:text-white text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modalContent" class="p-6">
                <!-- Movie details will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_KEY = 'b9a48916'; // Free OMDb API key for demonstration
        const BASE_URL = 'https://www.omdbapi.com/';
        
        // State Management
        let currentPage = 1;
        let currentSearch = '';
        let totalResults = 0;
        let favorites = JSON.parse(localStorage.getItem('movieExplorerFavorites')) || [];

        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const moviesContainer = document.getElementById('moviesContainer');
        const loadMoreContainer = document.getElementById('loadMoreContainer');
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const errorMessage = document.getElementById('errorMessage');
        const retryBtn = document.getElementById('retryBtn');
        const noResultsState = document.getElementById('noResultsState');
        const movieModal = document.getElementById('movieModal');
        const modalContent = document.getElementById('modalContent');
        const modalTitle = document.getElementById('modalTitle');
        const closeModal = document.getElementById('closeModal');
        const homeBtn = document.getElementById('homeBtn');
        const favoritesBtn = document.getElementById('favoritesBtn');
        const favoritesSection = document.getElementById('favoritesSection');
        const favoritesContainer = document.getElementById('favoritesContainer');

        // Event Listeners
        searchBtn.addEventListener('click', () => {
            const query = searchInput.value.trim();
            if (query) {
                currentSearch = query;
                currentPage = 1;
                searchMovies(query, 1);
            }
        });

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const query = searchInput.value.trim();
                if (query) {
                    currentSearch = query;
                    currentPage = 1;
                    searchMovies(query, 1);
                }
            }
        });

        loadMoreBtn.addEventListener('click', () => {
            currentPage++;
            searchMovies(currentSearch, currentPage, true);
        });

        retryBtn.addEventListener('click', () => {
            if (currentSearch) {
                searchMovies(currentSearch, currentPage);
            } else {
                loadDefaultMovies();
            }
        });

        closeModal.addEventListener('click', () => {
            movieModal.classList.add('hidden');
        });

        homeBtn.addEventListener('click', () => {
            showHomeView();
        });

        favoritesBtn.addEventListener('click', () => {
            showFavoritesView();
        });

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            loadDefaultMovies();
        });

        // Functions
        async function searchMovies(query, page = 1, append = false) {
            try {
                showLoading();
                hideError();
                hideNoResults();

                const response = await fetch(`${BASE_URL}?apikey=${API_KEY}&s=${encodeURIComponent(query)}&page=${page}`);
                const data = await response.json();

                if (data.Response === 'True') {
                    totalResults = parseInt(data.totalResults);
                    displayMovies(data.Search, append);
                    
                    // Show load more button if there are more results
                    if (moviesContainer.children.length < totalResults) {
                        loadMoreContainer.classList.remove('hidden');
                    } else {
                        loadMoreContainer.classList.add('hidden');
                    }
                } else {
                    if (!append && page === 1) {
                        showNoResults();
                    } else {
                        showError(data.Error || 'No more results available.');
                    }
                    loadMoreContainer.classList.add('hidden');
                }
            } catch (error) {
                showError('Failed to fetch movies. Please check your connection and try again.');
                console.error('Error fetching movies:', error);
            } finally {
                hideLoading();
            }
        }

        function fetchMovieDetails(id) {
            return new Promise((resolve, reject) => {
                fetch(`${BASE_URL}?apikey=${API_KEY}&i=${id}&plot=full`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.Response === 'True') {
                            resolve(data);
                        } else {
                            reject(new Error(data.Error || 'Failed to fetch movie details'));
                        }
                    })
                    .catch(error => {
                        reject(error);
                    });
            });
        }

        function displayMovies(movies, append = false) {
            if (!append) {
                moviesContainer.innerHTML = '';
            }

            if (movies.length === 0) {
                showNoResults();
                return;
            }

            movies.forEach(movie => {
                const movieCard = document.createElement('div');
                movieCard.className = 'movie-card bg-gray-800 rounded-xl overflow-hidden fade-in';
                movieCard.innerHTML = `
                    <div class="relative">
                        <img 
                            src="${movie.Poster !== 'N/A' ? movie.Poster : 'https://via.placeholder.com/300x450/1a1a2e/ffffff?text=No+Image'}" 
                            alt="${movie.Title}"
                            class="w-full h-64 object-cover"
                        >
                        <button class="absolute top-2 right-2 bg-black bg-opacity-70 text-white p-2 rounded-full favorite-btn ${isFavorite(movie.imdbID) ? 'text-red-500' : 'text-gray-300'}" data-id="${movie.imdbID}">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg mb-1 truncate">${movie.Title}</h3>
                        <p class="text-gray-400 mb-3">${movie.Year}</p>
                        <button class="w-full bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 details-btn" data-id="${movie.imdbID}">
                            View Details
                        </button>
                    </div>
                `;
                moviesContainer.appendChild(movieCard);
            });

            // Add event listeners to the new buttons
            document.querySelectorAll('.details-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const movieId = e.target.getAttribute('data-id');
                    showMovieDetails(movieId);
                });
            });

            document.querySelectorAll('.favorite-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const movieId = e.target.closest('.favorite-btn').getAttribute('data-id');
                    toggleFavorite(movieId, e.target.closest('.favorite-btn'));
                });
            });
        }

        async function showMovieDetails(id) {
            try {
                showLoading();
                const movie = await fetchMovieDetails(id);
                hideLoading();
                
                modalTitle.textContent = movie.Title;
                modalContent.innerHTML = `
                    <div class="flex flex-col md:flex-row gap-6">
                        <div class="md:w-1/3">
                            <img 
                                src="${movie.Poster !== 'N/A' ? movie.Poster : 'https://via.placeholder.com/300x450/1a1a2e/ffffff?text=No+Image'}" 
                                alt="${movie.Title}"
                                class="w-full rounded-lg"
                            >
                        </div>
                        <div class="md:w-2/3">
                            <h2 class="text-2xl font-bold mb-2">${movie.Title}</h2>
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="bg-gray-700 text-white px-3 py-1 rounded-full text-sm">${movie.Year}</span>
                                <span class="bg-gray-700 text-white px-3 py-1 rounded-full text-sm">${movie.Rated}</span>
                                <span class="bg-gray-700 text-white px-3 py-1 rounded-full text-sm">${movie.Runtime}</span>
                                <span class="bg-gray-700 text-white px-3 py-1 rounded-full text-sm">${movie.Genre}</span>
                            </div>
                            
                            <div class="mb-4">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-star text-yellow-500 mr-2"></i>
                                    <span class="font-bold">${movie.imdbRating}</span>
                                    <span class="text-gray-400 ml-2">/10 (${movie.imdbVotes} votes)</span>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h3 class="text-lg font-bold mb-2">Plot</h3>
                                <p class="text-gray-300">${movie.Plot}</p>
                            </div>
                            
                            <div class="mb-4">
                                <h3 class="text-lg font-bold mb-2">Director</h3>
                                <p class="text-gray-300">${movie.Director}</p>
                            </div>
                            
                            <div class="mb-4">
                                <h3 class="text-lg font-bold mb-2">Cast</h3>
                                <p class="text-gray-300">${movie.Actors}</p>
                            </div>
                            
                            <div class="flex justify-between mt-6">
                                <button class="bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300" id="modalFavoriteBtn" data-id="${movie.imdbID}">
                                    <i class="fas fa-heart mr-2"></i>
                                    ${isFavorite(movie.imdbID) ? 'Remove from Favorites' : 'Add to Favorites'}
                                </button>
                                <a href="https://www.imdb.com/title/${movie.imdbID}" target="_blank" class="bg-gradient-to-r from-yellow-600 to-orange-500 hover:from-yellow-700 hover:to-orange-600 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300 flex items-center">
                                    <i class="fab fa-imdb mr-2"></i> View on IMDb
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add event listener to the favorite button in the modal
                document.getElementById('modalFavoriteBtn').addEventListener('click', (e) => {
                    const movieId = e.target.getAttribute('data-id');
                    toggleFavorite(movieId);
                    // Update the button text
                    e.target.innerHTML = isFavorite(movieId) 
                        ? '<i class="fas fa-heart mr-2"></i>Remove from Favorites' 
                        : '<i class="fas fa-heart mr-2"></i>Add to Favorites';
                });
                
                movieModal.classList.remove('hidden');
            } catch (error) {
                showError('Failed to load movie details. Please try again.');
                console.error('Error fetching movie details:', error);
            }
        }

        function toggleFavorite(movieId, buttonElement = null) {
            const index = favorites.indexOf(movieId);
            
            if (index === -1) {
                // Add to favorites
                favorites.push(movieId);
                if (buttonElement) {
                    buttonElement.innerHTML = '<i class="fas fa-heart text-red-500"></i>';
                }
            } else {
                // Remove from favorites
                favorites.splice(index, 1);
                if (buttonElement) {
                    buttonElement.innerHTML = '<i class="fas fa-heart text-gray-300"></i>';
                }
            }
            
            // Update localStorage
            localStorage.setItem('movieExplorerFavorites', JSON.stringify(favorites));
            
            // If we're in the favorites view, update it
            if (favoritesSection.classList.contains('hidden') === false) {
                displayFavorites();
            }
        }

        function isFavorite(movieId) {
            return favorites.includes(movieId);
        }

        function displayFavorites() {
            favoritesContainer.innerHTML = '';
            
            if (favorites.length === 0) {
                favoritesContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-heart text-5xl text-gray-500 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">No favorites yet</h3>
                        <p class="text-gray-400">Start adding movies to your favorites!</p>
                    </div>
                `;
                return;
            }
            
            // For each favorite ID, fetch the movie details and display it
            favorites.forEach(movieId => {
                fetchMovieDetails(movieId)
                    .then(movie => {
                        const favoriteCard = document.createElement('div');
                        favoriteCard.className = 'movie-card bg-gray-800 rounded-xl overflow-hidden fade-in';
                        favoriteCard.innerHTML = `
                            <div class="relative">
                                <img 
                                    src="${movie.Poster !== 'N/A' ? movie.Poster : 'https://via.placeholder.com/300x450/1a1a2e/ffffff?text=No+Image'}" 
                                    alt="${movie.Title}"
                                    class="w-full h-64 object-cover"
                                >
                                <button class="absolute top-2 right-2 bg-black bg-opacity-70 text-red-500 p-2 rounded-full favorite-btn" data-id="${movie.imdbID}">
                                    <i class="fas fa-heart"></i>
                                </button>
                            </div>
                            <div class="p-4">
                                <h3 class="font-bold text-lg mb-1 truncate">${movie.Title}</h3>
                                <p class="text-gray-400 mb-3">${movie.Year}</p>
                                <button class="w-full bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 details-btn" data-id="${movie.imdbID}">
                                    View Details
                                </button>
                            </div>
                        `;
                        favoritesContainer.appendChild(favoriteCard);
                        
                        // Add event listeners
                        favoriteCard.querySelector('.details-btn').addEventListener('click', (e) => {
                            const movieId = e.target.getAttribute('data-id');
                            showMovieDetails(movieId);
                        });
                        
                        favoriteCard.querySelector('.favorite-btn').addEventListener('click', (e) => {
                            const movieId = e.target.closest('.favorite-btn').getAttribute('data-id');
                            toggleFavorite(movieId, e.target.closest('.favorite-btn'));
                            // Remove the card from the favorites view
                            favoriteCard.remove();
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching favorite movie:', error);
                    });
            });
        }

        function showHomeView() {
            favoritesSection.classList.add('hidden');
            moviesContainer.classList.remove('hidden');
            loadMoreContainer.classList.remove('hidden');
            homeBtn.classList.add('bg-gradient-to-r', 'from-purple-600', 'to-pink-500');
            favoritesBtn.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-teal-500');
            favoritesBtn.classList.add('bg-gray-700');
        }

        function showFavoritesView() {
            favoritesSection.classList.remove('hidden');
            moviesContainer.classList.add('hidden');
            loadMoreContainer.classList.add('hidden');
            favoritesBtn.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-teal-500');
            homeBtn.classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-pink-500');
            homeBtn.classList.add('bg-gray-700');
            displayFavorites();
        }

        function loadDefaultMovies() {
            currentSearch = 'action';
            searchMovies('action', 1);
        }

        function showLoading() {
            loadingState.classList.remove('hidden');
            moviesContainer.classList.add('hidden');
            loadMoreContainer.classList.add('hidden');
        }

        function hideLoading() {
            loadingState.classList.add('hidden');
            moviesContainer.classList.remove('hidden');
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorState.classList.remove('hidden');
            moviesContainer.classList.add('hidden');
            loadMoreContainer.classList.add('hidden');
        }

        function hideError() {
            errorState.classList.add('hidden');
        }

        function showNoResults() {
            noResultsState.classList.remove('hidden');
            moviesContainer.classList.add('hidden');
            loadMoreContainer.classList.add('hidden');
        }

        function hideNoResults() {
            noResultsState.classList.add('hidden');
        }
    </script>
</body>
</html>